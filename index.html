<!DOCTYPE html>
<html>
<head>
    <title>My Mapbox Map</title>
    <!-- Add Mapbox CSS -->
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        #map {
            width: 100vw;
            height: 100vh;
            max-width: 100%;
        }
        .user-location-marker {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: blue;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            border: 2px solid white;
        }
        .user-location-marker::after {
            content: 'â–²';
            transform: rotate(0deg); /* Adjust rotation as needed */
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Add Mapbox JS -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1Ijoic2NobWlkc3RhIiwiYSI6ImNscG02OWFvdTA1aTUya3FuZ2tzbnB6ejAifQ.bxFVJbOBulC_Y9YskaKxjg';

        var map;
        var locationMarkerElement = document.createElement('div');
        locationMarkerElement.className = 'user-location-marker';

        // Function to initialize the map
        function initializeMap(longitude, latitude) {
            map = new mapboxgl.Map({
                container: 'map', // container ID
                style: 'mapbox://styles/schmidsta/cl8zj69gv000014piwjpgxkcv', // style URL
                center: [longitude, latitude], // starting position [lng, lat]
                zoom: 17 // starting zoom
            });

            // Create a new marker for the user's location
            new mapboxgl.Marker(locationMarkerElement)
                .setLngLat([longitude, latitude])
                .addTo(map);
        }

        // Function to update the marker's position
        function updateMarkerPosition(longitude, latitude) {
            locationMarkerElement.style.transform = `translate(-50%, -50%) rotate(${calculateBearing(longitude, latitude)}deg)`;
            new mapboxgl.Marker(locationMarkerElement)
                .setLngLat([longitude, latitude])
                .addTo(map);
        }

        // Calculate the bearing of the marker
        function calculateBearing(longitude, latitude) {
            // This is a placeholder function. Replace with actual logic to calculate bearing.
            // For example, you could calculate the bearing based on the user's movement direction.
            return 0; // Replace with actual bearing calculation
        }

        // Get and watch user's location
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                initializeMap(position.coords.longitude, position.coords.latitude);
                
                // Watch the position and update marker accordingly
                navigator.geolocation.watchPosition(function(position) {
                    updateMarkerPosition(position.coords.longitude, position.coords.latitude);
                }, function(error) {
                    console.log("Error: " + error.message);
                }, {
                    enableHighAccuracy: true
                });

            }, function() {
                initializeMap(149.131, -35.270); // Default location
            });
        } else {
            initializeMap(149.131, -35.270); // Default location
        }
    </script>
</body>
</html>
